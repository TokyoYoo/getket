<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 15px 20px;
            margin: 5px 0;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: white;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid #e3e6f0;
            padding: 12px 15px;
        }
        .btn {
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            border: none;
        }
        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
        }
        .alert {
            border-radius: 10px;
            border: none;
        }
        .form-label {
            font-weight: 600;
            color: #5a5c69;
            margin-bottom: 8px;
        }
        .input-group-text {
            border-radius: 10px 0 0 10px;
            border: 1px solid #e3e6f0;
            background: #f8f9fc;
        }
        .input-group .form-control {
            border-radius: 0 10px 10px 0;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 px-0">
                <div class="sidebar d-flex flex-column p-3">
                    <h4 class="text-white mb-4">
                        <i class="fas fa-key me-2"></i>Admin Panel
                    </h4>
                    
                    <ul class="nav nav-pills flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/dashboard">
                                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/keys">
                                <i class="fas fa-key me-2"></i>Key Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/admin/settings">
                                <i class="fas fa-cog me-2"></i>Settings
                            </a>
                        </li>
                    </ul>
                    
                    <div class="mt-auto">
                        <div class="text-white-50 small mb-2">
                            <i class="fas fa-user me-1"></i>Logged in as: <%= admin.username %>
                        </div>
                        <a href="/admin/logout" class="btn btn-outline-light btn-sm">
                            <i class="fas fa-sign-out-alt me-1"></i>Logout
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10">
                <div class="p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h1 class="h3 text-gray-800">
                            <i class="fas fa-cog me-2"></i>System Settings
                        </h1>
                    </div>

                    <!-- Alert Messages -->
                    <% if (message) { %>
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="fas fa-check-circle me-2"></i><%= message %>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    <% } %>
                    
                    <% if (error) { %>
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i><%= error %>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    <% } %>

                    <form action="/admin/settings" method="POST">
                        <div class="row">
                            <!-- Key Settings -->
                            <div class="col-lg-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-key me-2"></i>Key Settings
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="keyExpirationHours" class="form-label">
                                                <i class="fas fa-clock me-1"></i>Key Expiration (Hours)
                                            </label>
                                            <input type="number" class="form-control" id="keyExpirationHours" 
                                                   name="keyExpirationHours" value="<%= config.keyExpirationHours %>" 
                                                   min="1" max="168" required>
                                            <div class="form-text">Keys will expire after this many hours (Max: 168 hours = 1 week)</div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="allowedIpsPerKey" class="form-label">
                                                <i class="fas fa-network-wired me-1"></i>Allowed IPs per Key
                                            </label>
                                            <select class="form-select" id="allowedIpsPerKey" name="allowedIpsPerKey">
                                                <option value="1" <%= config.allowedIpsPerKey === 1 ? 'selected' : '' %>>1 IP Address</option>
                                                <option value="2" <%= config.allowedIpsPerKey === 2 ? 'selected' : '' %>>2 IP Addresses</option>
                                                <option value="3" <%= config.allowedIpsPerKey === 3 ? 'selected' : '' %>>3 IP Addresses</option>
                                                <option value="4" <%= config.allowedIpsPerKey === 4 ? 'selected' : '' %>>4 IP Addresses</option>
                                                <option value="5" <%= config.allowedIpsPerKey === 5 ? 'selected' : '' %>>5 IP Addresses</option>
                                            </select>
                                        </div>

                                        <div class="mb-3">
                                            <label for="rateLimitPerHour" class="form-label">
                                                <i class="fas fa-tachometer-alt me-1"></i>Rate Limit (per hour)
                                            </label>
                                            <input type="number" class="form-control" id="rateLimitPerHour" 
                                                   name="rateLimitPerHour" value="<%= config.rateLimitPerHour %>" 
                                                   min="10" max="1000" required>
                                            <div class="form-text">Maximum API requests per IP per hour</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Linkvertise Settings -->
                            <div class="col-lg-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header bg-warning text-dark">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-ad me-2"></i>Linkvertise Settings
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="linkvertiseId1" class="form-label">
                                                <i class="fas fa-bookmark me-1"></i>Checkpoint 1 ID
                                            </label>
                                            <input type="number" class="form-control" id="linkvertiseId1" 
                                                   name="linkvertiseId1" value="<%= config.linkvertiseId1 %>" required>
                                        </div>

                                        <div class="mb-3">
                                            <label for="linkvertiseId2" class="form-label">
                                                <i class="fas fa-bookmark me-1"></i>Checkpoint 2 ID
                                            </label>
                                            <input type="number" class="form-control" id="linkvertiseId2" 
                                                   name="linkvertiseId2" value="<%= config.linkvertiseId2 %>" required>
                                        </div>

                                        <div class="mb-3">
                                            <label for="linkvertiseId3" class="form-label">
                                                <i class="fas fa-bookmark me-1"></i>Checkpoint 3 ID
                                            </label>
                                            <input type="number" class="form-control" id="linkvertiseId3" 
                                                   name="linkvertiseId3" value="<%= config.linkvertiseId3 %>" required>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Webhook Settings -->
                            <div class="col-lg-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-webhook me-2"></i>Webhook Settings
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="isWebhookEnabled" 
                                                       name="isWebhookEnabled" <%= config.isWebhookEnabled ? 'checked' : '' %>>
                                                <label class="form-check-label" for="isWebhookEnabled">
                                                    Enable Webhook Notifications
                                                </label>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="webhookUrl" class="form-label">
                                                <i class="fas fa-link me-1"></i>Webhook URL
                                            </label>
                                            <input type="url" class="form-control" id="webhookUrl" 
                                                   name="webhookUrl" value="<%= config.webhookUrl %>" 
                                                   placeholder="https://discord.com/api/webhooks/...">
                                            <div class="form-text">Discord webhook URL for notifications</div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="webhookInterval" class="form-label">
                                                <i class="fas fa-clock me-1"></i>Webhook Interval (Minutes)
                                            </label>
                                            <select class="form-select" id="webhookInterval" name="webhookInterval">
                                                <option value="5" <%= config.webhookInterval === 5 ? 'selected' : '' %>>Every 5 minutes</option>
                                                <option value="15" <%= config.webhookInterval === 15 ? 'selected' : '' %>>Every 15 minutes</option>
                                                <option value="30" <%= config.webhookInterval === 30 ? 'selected' : '' %>>Every 30 minutes</option>
                                                <option value="60" <%= config.webhookInterval === 60 ? 'selected' : '' %>>Every 1 hour</option>
                                                <option value="120" <%= config.webhookInterval === 120 ? 'selected' : '' %>>Every 2 hours</option>
                                                <option value="360" <%= config.webhookInterval === 360 ? 'selected' : '' %>>Every 6 hours</option>
                                                <option value="720" <%= config.webhookInterval === 720 ? 'selected' : '' %>>Every 12 hours</option>
                                                <option value="1440" <%= config.webhookInterval === 1440 ? 'selected' : '' %>>Every 24 hours</option>
                                            </select>
                                        </div>

                                        <button type="button" class="btn btn-outline-info btn-sm" onclick="testWebhook()">
                                            <i class="fas fa-vial me-1"></i>Test Webhook
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- System Settings -->
                            <div class="col-lg-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-cogs me-2"></i>System Settings
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="systemMessage" class="form-label">
                                                <i class="fas fa-comment me-1"></i>System Message
                                            </label>
                                            <textarea class="form-control" id="systemMessage" name="systemMessage" 
                                                      rows="3" maxlength="500"><%= config.systemMessage %></textarea>
                                            <div class="form-text">Message shown to users (Max: 500 characters)</div>
                                        </div>

                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="maintenanceMode" 
                                                       name="maintenanceMode" <%= config.maintenanceMode ? 'checked' : '' %>>
                                                <label class="form-check-label" for="maintenanceMode">
                                                    <i class="fas fa-wrench me-1"></i>Maintenance Mode
                                                </label>
                                            </div>
                                            <div class="form-text">Disable key generation when enabled</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Save Button -->
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <button type="submit" class="btn btn-primary btn-lg me-3">
                                            <i class="fas fa-save me-2"></i>Save Settings
                                        </button>
                                        <a href="/admin/dashboard" class="btn btn-secondary btn-lg">
                                            <i class="fas fa-times me-2"></i>Cancel
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function testWebhook() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Testing...';
            
            try {
                const response = await fetch('/admin/test-webhook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show success message
                    showAlert('success', result.message);
                } else {
                    // Show error message
                    showAlert('danger', result.message);
                }
            } catch (error) {
                showAlert('danger', 'Failed to test webhook: ' + error.message);
            } finally {
                button.disabled = false;
                button.innerHTML = originalText;
            }
        }
        
        function showAlert(type, message) {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // Insert alert at the top of the main content
            const alertContainer = document.querySelector('.col-md-9 .p-4');
            alertContainer.insertAdjacentHTML('afterbegin', alertHtml);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                const alert = alertContainer.querySelector('.alert');
                if (alert) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 5000);
        }
    </script>
</body>
</html>